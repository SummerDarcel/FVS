<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Pets</title>
</head>

<body>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.3/dist/css/foundation.min.css"
    integrity="sha256-xpOKVlYXzQ3P03j397+jWFZLMBXLES3IiryeClgU5og= sha384-gP4DhqyoT9b1vaikoHi9XQ8If7UNLO73JFOOlQV1RATrA7D0O7TjJZifac6NwPps sha512-AKwIib1E+xDeXe0tCgbc9uSvPwVYl6Awj7xl0FoaPFostZHOuDQ1abnDNCYtxL/HWEnVOMrFyf91TDgLPi9pNg=="
    crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="./styles/foundation.css">
  <link rel="stylesheet" type="text/css" href="./styles/styles.css">
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css?family=Mansalva&display=swap" rel="stylesheet">

  <title>View All Pets</title>
  <link rel="stylesheet" href="./styles/styles.css" />
  <script src="https://code.jquery.com/jquery.js"></script>
  </head>

  <body>
    <header class="subnav-hero-section">
        <h1 class="subnav-hero-headline">Ani-Mates</h1>
        <ul class="subnav-hero-subnav">
            <li><a href="/" class="is-active">Home</a></li>
            <li><a href="/questions.html" class="is-active">Find Your Match!</a></li>
            <li><a href="/pets.html" class="is-active">See All Pets</a></li>
            <li><a href="finder.html" class="is-active">Find a Pet near you!</a></li>
        </ul>
    </header>
    <br />
    <div class="grid-container">
      <container id="Pets">
        <table>
          <thead>
            <tr>
              <th width="200px">Photo</th>
              <th width="200px">Pet Name</th>
              <th width="200px">Pet Description</th>
            </tr>
          </thead>
          <tbody>

          </tbody>
        </table>
      </container>
    </div>
    <br />
    <div id="gifInfo"></div>
    <div class="container" id="gifStuff"></div>
    <script src="javascript.js"></script>

    <script type="text/javascript">
      $(document).ready(function () {
        $.ajax({
          url: "/api/allpets",
          method: "GET"
        }).then(function (data) {
          console.log(data)
          for (var i = 0; i < data.length; i++) {
            var tR = $("<tr>");
            var image = $("<img>").attr("src", data[i].petPhoto);
          
            tR.append(
              $("<td>").append(image),
              $("<td>").text(data[i].petName),
              $("<td>").text(data[i].petDescription)
            );
            $("tbody").append(tR);
          }
        });
      });
    

function searchGiphy() {
  $("#gifStuff").empty();
  var pet = $(this).attr("data-name");
  var queryURL = "https://api.giphy.com/v1/gifs/search?api_key=hDcyYQDAb4wguGxBI8nGwH1wyhq0SA1g&q=" + pet + "&limit=10&lang=en";
  
    $.ajax({
        url: queryURL,
        method: "GET"
    }).then(function(response) {
        let results = response.data;
        
          for (var i= 0; i <results.length; i++) {
            var fruitDiv = $("<div>");

            
            var image = $("<img>");
            image.attr({
              "src": results[i].images.fixed_height_small_still.url,
              "data-animate": results[i].images.fixed_height_small.url,
              "data-still": results[i].images.fixed_height_small_still.url,
              "data-state": "still",
              "class": "gif"
            });
            fruitDiv.append(image);
            var rating = results[i].rating;
            var p = $("<p>").text("Rating: " + results[i].rating);
            fruitDiv.append(p);
            
            $("#gifStuff").prepend(fruitDiv);
          }
        });
        
        $(document).on("click", ".gif", function() {
      var state = $(this).attr("data-state");
      if (state === "still") {
        $(this).attr("src", $(this).attr("data-animate"));
        $(this).attr("data-state", "animate");
      } else {
        $(this).attr("src", $(this).attr("data-still"));
        $(this).attr("data-state", "still");
      }
    }); 
}

$("#searchBtn").on("click", function(event) {
event.preventDefault();
var fruit = $("#gif-search").val().trim();
topics.push(fruit);
renderButtons();
});

$(document).on("click", ".fruit", searchGiphy);

renderButtons(); 
</script>
  </body>

</html>